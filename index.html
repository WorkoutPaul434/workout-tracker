<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Workout Tracker (Cloud)</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        * { font-family: 'Inter', system-ui, -apple-system, sans-serif; }
        body { margin: 0; padding: 0; background: linear-gradient(135deg, #0f0f0f 0%, #1a1a1a 100%); min-height: 100vh; color: white; overflow-x: hidden;}
        .gradient-bg { background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);}
        .glass-effect { background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(220, 38, 38, 0.2);}
        .card-hover { transition: all 0.3s ease;}
        .card-hover:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(220, 38, 38, 0.2);}
        .glow { box-shadow: 0 0 20px rgba(220, 38, 38, 0.3);}
        .pulse-animation { animation: pulse 2s infinite;}
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .mobile-safe { padding-bottom: env(safe-area-inset-bottom);}
        input:focus, select:focus { outline: none; ring: 2px solid #dc2626;}
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none;}
        .scrollbar-hide::-webkit-scrollbar { display: none;}
        .light-mode { background: linear-gradient(135deg, #f9fafb 0%, #e5e7eb 100%) !important; color: #111 !important;}
    </style>
</head>
<body>
    <div id="root"></div>
    <!-- Initialize Firebase -->
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyADRPIZ5BQoFqtevuVpadsRif5F3soKlug",
        authDomain: "workout-tracker-62e56.firebaseapp.com",
        projectId: "workout-tracker-62e56",
        storageBucket: "workout-tracker-62e56.firebasestorage.app",
        messagingSenderId: "195952292211",
        appId: "1:195952292211:web:f3ce90c79878de6c3a1506"
      };
      firebase.initializeApp(firebaseConfig);
    </script>
    <script type="text/babel">
    // --- Firestore hook for cloud sync ---
    function useCloudState(user, key, initialValue) {
        const [state, setState] = React.useState(initialValue);
        const firstLoad = React.useRef(true);

        React.useEffect(() => {
            if (!user) return;
            const db = firebase.firestore();
            const ref = db.collection('users').doc(user.uid);
            let unsub = ref.onSnapshot(doc => {
                if (doc.exists && doc.data()[key] !== undefined) {
                    setState(doc.data()[key]);
                }
            });
            return () => unsub && unsub();
        }, [user, key]);

        React.useEffect(() => {
            if (!user) return;
            if (firstLoad.current) { firstLoad.current = false; return; }
            const db = firebase.firestore();
            const ref = db.collection('users').doc(user.uid);
            ref.set({ [key]: state }, { merge: true });
        }, [user, key, state]);

        return [state, setState];
    }

    // --- Progress Chart using minimal chart.js via CDN ---
    function ProgressChart({ history, lift }) {
        const ref = React.useRef();
        React.useEffect(() => {
            if (!window.Chart) {
                const script = document.createElement('script');
                script.src = 'https://cdn.jsdelivr.net/npm/chart.js';
                script.onload = renderChart;
                document.head.appendChild(script);
            } else {
                renderChart();
            }
            function renderChart() {
                if (!history || !history.length) return;
                const ctx = ref.current.getContext('2d');
                if (ref.current.chart) { ref.current.chart.destroy(); }
                // Find best (max) set for the lift per workout
                const data = (history || [])
                    .map(entry => {
                        let sets = [];
                        if (entry.exercises && typeof entry.exercises === "object") {
                            Object.values(entry.exercises).forEach(e => {
                                if (e && e.lift === lift && Array.isArray(e.sets)) {
                                    sets = sets.concat((e.sets || []).filter(s => s && s.done && s.weight && s.reps));
                                }
                            });
                        }
                        // Estimate 1RM for each set (Epley): weight * (1 + reps/30)
                        const bestSet = sets.reduce((best, s) => {
                            if (!s.weight || !s.reps) return best;
                            const est = s.weight * (1 + s.reps / 30);
                            return !best || est > best.est ? { ...s, est } : best;
                        }, null);
                        return bestSet ? { date: entry.date, est: Math.round(bestSet.est) } : null;
                    })
                    .filter(Boolean);
                if (!data.length) return;
                ref.current.chart = new window.Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: data.map(d => d.date),
                        datasets: [{
                            label: lift.charAt(0).toUpperCase() + lift.slice(1) + ' (Estimated 1RM)',
                            data: data.map(d => d.est),
                            fill: false,
                            borderColor: 'rgb(239,68,68)',
                            tension: 0.2,
                            pointBackgroundColor: 'rgb(239,68,68)'
                        }]
                    },
                    options: {
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { title: { display: true, text: 'Date' }},
                            y: { title: { display: true, text: 'Estimated 1RM (kg)' }, beginAtZero: false }
                        }
                    }
                });
            }
        }, [history, lift]);
        return (
            <canvas ref={ref} width={320} height={180} className="bg-gray-900 rounded-xl block mx-auto mb-4" />
        );
    }

    function WorkoutTracker() {
        const [user, setUser] = React.useState(null);
        const [authLoading, setAuthLoading] = React.useState(true);

        React.useEffect(() => {
            const unsub = firebase.auth().onAuthStateChanged(u => { setUser(u); setAuthLoading(false); });
            return () => unsub();
        }, []);

        // --- Cloud states ---
        const [oneRepMaxes, setOneRepMaxes] = useCloudState(user, 'oneRepMaxes', { bench: 102, deadlift: 143, squat: 125 });
        const [workoutHistory, setWorkoutHistory] = useCloudState(user, 'workoutHistory', []);
        const [activeTab, setActiveTab] = useCloudState(user, 'activeTab', 'workout');
        const [selectedDay, setSelectedDay] = useCloudState(user, 'selectedDay', 'monday');
        const [isPeaking, setIsPeaking] = useCloudState(user, 'isPeaking', false);
        const [peakingWeek, setPeakingWeek] = useCloudState(user, 'peakingWeek', 1);
        const [lightMode, setLightMode] = useCloudState(user, 'lightMode', false);
        const [customExercises, setCustomExercises] = useCloudState(user, 'customExercises', []);
        const [setInputs, setSetInputs] = React.useState({});

        const [currentDate] = React.useState(new Date());

        // --- Workout Plan ---
        function getWorkoutPlan() {
            const basePlan = {
                monday: {
                    name: "Push (Bench Focus)",
                    emoji: "üí™",
                    exercises: [
                        { name: "Barbell Bench Press", sets: "1 top single @ 85-90%, then 3x5-8 @ 75-80%", lift: "bench" },
                        { name: "Pec Fly (Machine or DB)", sets: "2x8-10", lift: null },
                        { name: "Seated DB Shoulder Press", sets: "2x6-8", lift: null },
                        { name: "Lateral Raises", sets: "3x10-12", lift: null },
                        { name: "Triceps Pushdowns", sets: "2x8-10", lift: null }
                    ]
                },
                tuesday: {
                    name: "Pull (Speed Deadlift & Back)",
                    emoji: "üî•",
                    exercises: [
                        { name: "Speed Deadlifts", sets: "4x2 @ 65-70%", lift: "deadlift" },
                        { name: "Weighted Pull-Ups", sets: "3x6-8", lift: null },
                        { name: "Chest-Supported T-Bar Row", sets: "2x6-8", lift: null },
                        { name: "Narrow Cable Row", sets: "2x8-10", lift: null },
                        { name: "Incline Cable Curls", sets: "2x8-10", lift: null },
                        { name: "Cable Hammer Curls", sets: "1x8-10", lift: null }
                    ]
                },
                wednesday: {
                    name: "Legs (Quad Focus)",
                    emoji: "ü¶µ",
                    exercises: [
                        { name: "Back Squat", sets: "1 top single @ 85-88%, then 3x5-6 @ 80-85%", lift: "squat" },
                        { name: "Lying Leg Curl", sets: "3x8-10", lift: null },
                        { name: "Romanian Deadlift (RDL)", sets: "3x6-8", lift: null },
                        { name: "Standing Calf Raises", sets: "3x10-12", lift: null },
                        { name: "Adductors", sets: "2x10-12", lift: null },
                        { name: "Abductors", sets: "2x10-12", lift: null },
                        { name: "Leg Extensions (optional)", sets: "2x10-12", lift: null }
                    ]
                },
                friday: {
                    name: "Upper (Incline & Bench)",
                    emoji: "üí•",
                    exercises: [
                        { name: "Incline DB Press", sets: "2x6-8 (last set to failure)", lift: null },
                        { name: "Paused Flat Bench Press", sets: "1 top single @ 85%, then 2x5-7 @ 75%", lift: "bench" },
                        { name: "Neutral Grip Pull-Ups", sets: "3x6-8", lift: null },
                        { name: "Chest Supported Row", sets: "2x8-10", lift: null },
                        { name: "Lateral Raises", sets: "2x10-12", lift: null },
                        { name: "Overhead Triceps Extensions", sets: "2x8-10", lift: null },
                        { name: "Preacher or Incline DB Curls", sets: "2x8-10", lift: null }
                    ]
                },
                saturday: {
                    name: "Lower (Heavy Deadlift)",
                    emoji: "‚ö°",
                    exercises: [
                        { name: "Deadlift", sets: "1 top single @ 85-90%, then 2-3x5 @ 75-80%", lift: "deadlift" },
                        { name: "Hack Squat or Safety Bar Squat", sets: "3x6-8", lift: null },
                        { name: "Back Extensions/Good Mornings", sets: "3x8-10", lift: null },
                        { name: "Standing Calf Raises", sets: "3x10-12", lift: null },
                        { name: "Lying Leg Curl", sets: "2x8-10", lift: null }
                    ]
                }
            };
            // Add custom exercises if any
            (customExercises || []).forEach(ex => {
                if (basePlan[ex.day] && !basePlan[ex.day].exercises.find(e => e.name === ex.name)) {
                    basePlan[ex.day].exercises.push({ name: ex.name, sets: ex.sets, lift: ex.lift || null, isCustom: true });
                }
            });
            return basePlan;
        }
        const workoutPlan = getWorkoutPlan();

        const calculateWeight = (lift, percentage) => {
            const oneRM = oneRepMaxes && oneRepMaxes[lift] ? oneRepMaxes[lift] : 0;
            return Math.round((oneRM * percentage / 100) * 4) / 4;
        };

        const parseExerciseWithWeights = (exercise) => {
            if (!exercise.lift) return exercise.sets;
            let parsedSets = exercise.sets;
            const patterns = [ /(\d+-\d+)%/g, /(\d+)%/g ];
            patterns.forEach(pattern => {
                parsedSets = parsedSets.replace(pattern, (match, percentage) => {
                    if (percentage.includes('-')) {
                        const [min, max] = percentage.split('-').map(Number);
                        const minWeight = calculateWeight(exercise.lift, min);
                        const maxWeight = calculateWeight(exercise.lift, max);
                        return `${percentage}% (${minWeight}-${maxWeight}kg)`;
                    } else {
                        const weight = calculateWeight(exercise.lift, parseInt(percentage));
                        return `${percentage}% (${weight}kg)`;
                    }
                });
            });
            return parsedSets;
        };

        const getCurrentDayName = () => {
            const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
            return days[currentDate.getDay()];
        };

        const isRestDay = (day) => day === 'thursday' || day === 'sunday';

        React.useEffect(() => {
            const today = getCurrentDayName();
            if (!isRestDay(today)) setSelectedDay(today);
        }, []);

        const saveWorkout = () => {
            const today = currentDate.toISOString().split('T')[0];
            const workoutKey = `${today}-${selectedDay}`;
            // Gather exercise data from setInputs
            const exercisesData = {};
            (workoutPlan[selectedDay]?.exercises || []).forEach(exercise => {
                const exerciseKey = `${selectedDay}-${exercise.name}`;
                exercisesData[exerciseKey] = {
                    name: exercise.name,
                    lift: exercise.lift || null,
                    sets: [1,2,3,4].map(setNum => {
                        const setKey = `${exerciseKey}-set${setNum}`;
                        return setInputs[setKey] || { weight: '', reps: '', done: false };
                    })
                };
            });
            setWorkoutHistory(prev => [...(prev || []), {
                date: today,
                day: selectedDay,
                workout: workoutPlan[selectedDay]?.name,
                exercises: exercisesData
            }]);
            setSetInputs({});
        };

        const getPeakingModifications = (exercise, week) => {
            if (!exercise.lift) return exercise.sets;
            switch (week) {
                case 1:
                    if (exercise.name.includes('Bench Press') || exercise.name.includes('Deadlift') || exercise.name.includes('Squat')) {
                        return exercise.sets.replace(/85-90%|85-88%/, '88-90%').replace(/3x5-8|3x5-6|2-3x5/, '2x4') + ' (Heavy Practice)';
                    }
                    return exercise.sets;
                case 2:
                    if (exercise.name.includes('Bench Press') || exercise.name.includes('Deadlift') || exercise.name.includes('Squat')) {
                        return exercise.sets.replace(/85-90%|85-88%/, '92-94%').replace(/3x5-8|3x5-6|2-3x5/, '1x3') + ' (Volume Drop)';
                    }
                    return exercise.sets;
                case 3:
                    if (exercise.name.includes('Bench Press') || exercise.name.includes('Deadlift') || exercise.name.includes('Squat')) {
                        return 'Max Week - Test 1RM (Fri/Sat)';
                    }
                    return 'Technique sets: 3x2 @ 60-65%';
                default:
                    return exercise.sets;
            }
        };

        function handleAddCustomExercise(day, name, sets, lift) {
            if (!day || !name || !sets) return;
            setCustomExercises(prev => [...(prev || []), { day, name, sets, lift }]);
        }
        function handleRemoveCustomExercise(day, name) {
            setCustomExercises(prev => (prev || []).filter(e => !(e.day === day && e.name === name)));
        }

        React.useEffect(() => {
            if (lightMode) document.body.classList.add('light-mode');
            else document.body.classList.remove('light-mode');
        }, [lightMode]);

        if (authLoading) return <div className="flex items-center justify-center min-h-screen">Loading...</div>;
        if (!user) {
            return (
                <div className="flex flex-col items-center justify-center min-h-screen">
                    <h1 className="text-3xl font-bold mb-8">Workout Tracker</h1>
                    <button
                        onClick={() => firebase.auth().signInWithPopup(new firebase.auth.GoogleAuthProvider())}
                        className="gradient-bg text-white px-8 py-4 rounded-xl text-xl hover:scale-105 transition-all glow"
                    >Sign in with Google</button>
                </div>
            );
        }

        return (
            <div className={`min-h-screen ${lightMode ? 'light-mode' : 'bg-gray-900'} mobile-safe`}>
                {/* Header and nav */}
                <div className="sticky top-0 z-50 glass-effect border-b border-red-600/30">
                    <div className="max-w-7xl mx-auto px-4 py-4">
                        <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-3">
                                <div className="w-10 h-10 gradient-bg rounded-xl flex items-center justify-center glow">
                                    <span className="text-xl font-bold">üí™</span>
                                </div>
                                <h1 className="text-xl md:text-2xl font-bold text-white">Workout Tracker</h1>
                            </div>
                            <div className="text-sm text-gray-300 hidden sm:block">
                                {currentDate.toLocaleDateString('en-US', { 
                                    weekday: 'short', 
                                    month: 'short', 
                                    day: 'numeric' 
                                })}
                            </div>
                        </div>
                        <div className="flex space-x-1 mt-4 overflow-x-auto scrollbar-hide">
                            {[
                                { id: 'workout', label: 'Workout', icon: 'üéØ' },
                                { id: 'progress', label: 'Progress', icon: 'üìà' },
                                { id: 'settings', label: 'Settings', icon: '‚öôÔ∏è' }
                            ].map(tab => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`flex items-center space-x-2 px-4 py-2 rounded-xl font-medium transition-all whitespace-nowrap ${
                                        activeTab === tab.id 
                                            ? 'gradient-bg text-white glow' 
                                            : 'text-gray-300 hover:text-white hover:bg-gray-800/50'
                                    }`}
                                >
                                    <span>{tab.icon}</span>
                                    <span className="text-sm md:text-base">{tab.label}</span>
                                </button>
                            ))}
                            <button
                                onClick={() => firebase.auth().signOut()}
                                className="ml-auto text-xs text-red-300 underline"
                                style={{marginLeft: "auto"}}
                            >Sign out</button>
                        </div>
                    </div>
                </div>
                <div className="max-w-7xl mx-auto px-4 py-6 space-y-6">
                    {/* Workout Tab */}
                    {activeTab === 'workout' && (
                        <>
                            <div className="glass-effect rounded-2xl p-4 md:p-6 card-hover">
                                <h2 className="text-lg font-semibold mb-4 flex items-center text-white">
                                    <span className="mr-2">üìÖ</span>
                                    Weekly Split
                                </h2>
                                <div className="grid grid-cols-2 sm:grid-cols-7 gap-2">
                                    {['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'].map((day) => {
                                        const dayKey = day.toLowerCase();
                                        const isToday = getCurrentDayName() === dayKey;
                                        const isRest = isRestDay(dayKey);
                                        const workout = workoutPlan[dayKey];
                                        return (
                                            <div
                                                key={day}
                                                className={`p-3 rounded-xl text-center cursor-pointer transition-all transform hover:scale-105 ${
                                                    selectedDay === dayKey
                                                        ? 'gradient-bg border-2 border-red-400 text-white glow'
                                                        : isToday && !isRest
                                                        ? 'bg-red-800/50 border-2 border-red-600 text-white pulse-animation'
                                                        : isRest
                                                        ? 'bg-gray-800 border border-gray-600 text-gray-400'
                                                        : 'bg-gray-800 border border-gray-600 text-gray-300 hover:bg-gray-700'
                                                }`}
                                                onClick={() => !isRest && setSelectedDay(dayKey)}
                                            >
                                                <div className="font-medium text-sm mb-1">{day.slice(0, 3)}</div>
                                                <div className="text-xs">
                                                    {isRest ? 'üò¥ Rest' : (
                                                        <div>
                                                            <div className="text-lg mb-1">{workout.emoji}</div>
                                                            <div>{workout.name.split(' ')[0]}</div>
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                            <div className="glass-effect rounded-2xl p-4 md:p-6 card-hover">
                                <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-4 space-y-3 sm:space-y-0">
                                    <h3 className="text-lg font-semibold text-white flex items-center">
                                        <span className="mr-2">üéØ</span>
                                        Training Mode
                                    </h3>
                                    <div className="flex flex-col sm:flex-row items-start sm:items-center space-y-3 sm:space-y-0 sm:space-x-4">
                                        <label className="flex items-center">
                                            <input
                                                type="checkbox"
                                                checked={isPeaking}
                                                onChange={(e) => setIsPeaking(e.target.checked)}
                                                className="w-5 h-5 rounded border-gray-600 text-red-600 focus:ring-red-500 bg-gray-800"
                                            />
                                            <span className="ml-2 text-sm font-medium text-white">Peaking Block</span>
                                        </label>
                                        {isPeaking && (
                                            <select
                                                value={peakingWeek}
                                                onChange={(e) => setPeakingWeek(parseInt(e.target.value))}
                                                className="border border-gray-600 rounded-xl px-3 py-2 text-sm bg-gray-800 text-white focus:ring-2 focus:ring-red-500"
                                            >
                                                <option value={1}>Week 1 - Heavy Practice</option>
                                                <option value={2}>Week 2 - Volume Drop</option>
                                                <option value={3}>Week 3 - Max Week</option>
                                            </select>
                                        )}
                                    </div>
                                </div>
                                {isPeaking && (
                                    <div className="bg-red-900/50 border border-red-700/50 rounded-xl p-4">
                                        <p className="text-sm text-red-100">
                                            {peakingWeek === 1 && "üî• Heavy Practice: Top single @ 88-90%, reduce volume slightly"}
                                            {peakingWeek === 2 && "‚ö° Volume Drop: Top single @ 92-94%, skip some accessory sets"}
                                            {peakingWeek === 3 && "üèÜ Max Week: Light technique work Mon-Wed, test 1RM Fri/Sat"}
                                        </p>
                                    </div>
                                )}
                            </div>
                            {/* Custom Exercise Add/Remove */}
                            <div className="glass-effect rounded-2xl p-4 md:p-6 card-hover mb-4">
                                <h3 className="text-lg font-semibold text-white mb-2 flex items-center">
                                    <span className="mr-2">‚ûï</span>
                                    Add Custom Exercise
                                </h3>
                                <AddCustomExerciseForm onAdd={handleAddCustomExercise} />
                                {(customExercises || []).filter(e => e.day === selectedDay).length > 0 && (
                                    <div className="mt-4">
                                        <h4 className="text-sm font-semibold text-white mb-2">Your Added Exercises for Today:</h4>
                                        {(customExercises || []).filter(e => e.day === selectedDay).map(e => (
                                            <div key={e.name} className="flex items-center space-x-2 mb-1">
                                                <span className="text-white font-mono">{e.name} ({e.sets})</span>
                                                <button
                                                    className="text-xs text-red-400 underline"
                                                    onClick={() => handleRemoveCustomExercise(e.day, e.name)}
                                                >Remove</button>
                                            </div>
                                        ))}
                                    </div>
                                )}
                            </div>
                            {selectedDay && !isRestDay(selectedDay) && (
                                <div className="glass-effect rounded-2xl p-4 md:p-6 card-hover">
                                    <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-6 space-y-3 sm:space-y-0">
                                        <div className="flex items-center space-x-3">
                                            <span className="text-2xl">{workoutPlan[selectedDay].emoji}</span>
                                            <h2 className="text-xl font-semibold text-white">
                                                {workoutPlan[selectedDay].name}
                                            </h2>
                                        </div>
                                        <button
                                            onClick={saveWorkout}
                                            className="gradient-bg text-white px-6 py-3 rounded-xl hover:scale-105 transition-all glow flex items-center space-x-2"
                                        >
                                            <span>‚úÖ</span>
                                            <span>Complete Workout</span>
                                        </button>
                                    </div>
                                    <div className="space-y-4">
                                        {workoutPlan[selectedDay].exercises.map((exercise, index) => {
                                            const displaySets = isPeaking 
                                                ? getPeakingModifications(exercise, peakingWeek)
                                                : parseExerciseWithWeights(exercise);
                                            const exerciseKey = `${selectedDay}-${exercise.name}`;
                                            return (
                                                <div key={index} className="border border-red-600/30 rounded-xl p-4 bg-gray-800/50 hover:bg-gray-800/70 transition-all">
                                                    <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between mb-3 space-y-2 sm:space-y-0">
                                                        <h3 className="font-medium text-white text-lg">{exercise.name}</h3>
                                                        {exercise.lift && (
                                                            <span className="text-xs gradient-bg text-white px-3 py-1 rounded-full">
                                                                {exercise.lift.toUpperCase()}
                                                            </span>
                                                        )}
                                                        {exercise.isCustom && (
                                                            <span className="ml-2 text-xs text-yellow-400 font-bold">Custom</span>
                                                        )}
                                                    </div>
                                                    <p className="text-sm text-gray-300 mb-4 font-mono bg-gray-900/50 p-3 rounded-lg">
                                                        {displaySets}
                                                    </p>
                                                    <div className="grid grid-cols-1 sm:grid-cols-2 gap-3">
                                                        {[1, 2, 3, 4].map(setNum => {
                                                            const setKey = `${exerciseKey}-set${setNum}`;
                                                            const input = setInputs[setKey] || { weight: '', reps: '', done: false };
                                                            return (
                                                                <div
                                                                    key={setNum}
                                                                    className={`flex space-x-2 items-center p-2 rounded-lg transition-all
                                                                        ${input.done ? 'bg-gray-700 opacity-60 pointer-events-none' : 'bg-gray-900/50'}`}
                                                                >
                                                                    <input
                                                                        type="number"
                                                                        placeholder="Weight (kg)"
                                                                        step="0.25"
                                                                        value={input.weight}
                                                                        onChange={e =>
                                                                            setSetInputs(prev => ({
                                                                                ...prev,
                                                                                [setKey]: { ...input, weight: e.target.value }
                                                                            }))
                                                                        }
                                                                        className="flex-1 px-3 py-2 border border-gray-600 rounded-lg text-sm bg-gray-900 text-white placeholder-gray-500 focus:ring-2 focus:ring-red-500"
                                                                        disabled={input.done}
                                                                    />
                                                                    <input
                                                                        type="number"
                                                                        placeholder="Reps"
                                                                        value={input.reps}
                                                                        onChange={e =>
                                                                            setSetInputs(prev => ({
                                                                                ...prev,
                                                                                [setKey]: { ...input, reps: e.target.value }
                                                                            }))
                                                                        }
                                                                        className="w-16 px-3 py-2 border border-gray-600 rounded-lg text-sm bg-gray-900 text-white placeholder-gray-500 focus:ring-2 focus:ring-red-500"
                                                                        disabled={input.done}
                                                                    />
                                                                    <button
                                                                        className={`px-3 py-2 rounded-lg text-sm text-white transition-all ${
                                                                            input.done ? 'bg-gray-500' : 'gradient-bg hover:scale-105'
                                                                        }`}
                                                                        onClick={() =>
                                                                            setSetInputs(prev => ({
                                                                                ...prev,
                                                                                [setKey]: { ...input, done: !input.done }
                                                                            }))
                                                                        }
                                                                        type="button"
                                                                    >
                                                                        ‚úì
                                                                    </button>
                                                                </div>
                                                            );
                                                        })}
                                                    </div>
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            )}
                            {selectedDay && isRestDay(selectedDay) && (
                                <div className="glass-effect rounded-2xl p-8 text-center card-hover">
                                    <div className="text-6xl mb-4">üò¥</div>
                                    <h2 className="text-2xl font-semibold mb-3 text-white">Rest Day</h2>
                                    <p className="text-gray-300">Take a well-deserved break and let your muscles recover!</p>
                                </div>
                            )}
                        </>
                    )}
                    {/* Progress Tab */}
                    {activeTab === 'progress' && (
                        <div className="glass-effect rounded-2xl p-4 md:p-6 card-hover">
                            <h2 className="text-lg font-semibold mb-4 flex items-center text-white">
                                <span className="mr-2">üìä</span>
                                Workout History & Progress
                            </h2>
                            <div className="flex flex-wrap gap-6 mb-8">
                                <ProgressChart history={workoutHistory || []} lift="bench" />
                                <ProgressChart history={workoutHistory || []} lift="squat" />
                                <ProgressChart history={workoutHistory || []} lift="deadlift" />
                            </div>
                            {(!workoutHistory || workoutHistory.length === 0) ? (
                                <div className="text-center py-12">
                                    <div className="text-6xl mb-4">üìà</div>
                                    <p className="text-gray-400 text-lg">
                                        No workouts completed yet.<br/>Start tracking your progress!
                                    </p>
                                </div>
                            ) : (
                                <div className="space-y-3">
                                    {workoutHistory.slice(-10).reverse().map((workout, index) => (
                                        <div key={index} className="border border-red-600/30 rounded-xl p-4 bg-gray-800/50 hover:bg-gray-800/70 transition-all">
                                            <div className="flex flex-col sm:flex-row items-start sm:items-center justify-between space-y-2 sm:space-y-0">
                                                <div>
                                                    <h3 className="font-medium text-white flex items-center">
                                                        <span className="mr-2">üèãÔ∏è</span>
                                                        {workout.workout}
                                                    </h3>
                                                    <p className="text-sm text-gray-400">{workout.date}</p>
                                                </div>
                                                <button
                                                    className="text-xs text-red-400 underline"
                                                    onClick={() => {
                                                        setWorkoutHistory(prev => prev.filter((_, i) => i !== prev.length - 1 - index));
                                                    }}
                                                >Delete</button>
                                            </div>
                                            {/* Expanded workout details */}
                                            <div className="mt-3 space-y-2">
                                                {workout.exercises && Object.entries(workout.exercises).map(([ekey, exercise]) => (
                                                    <div key={ekey}>
                                                        <span className="font-semibold text-white">{exercise.name}</span>
                                                        {exercise.lift && (
                                                            <span className="ml-2 text-xs text-red-300 font-mono">[{exercise.lift.toUpperCase()}]</span>
                                                        )}
                                                        <div className="grid grid-cols-2 sm:grid-cols-4 gap-2 mt-1">
                                                            {(exercise.sets || []).map((set, idx) => (
                                                                <div key={idx} className={`text-xs px-2 py-1 rounded
                                                                    ${set && set.done ? 'bg-green-700 text-white' : 'bg-gray-700 text-gray-400'}`}>
                                                                    {set && set.weight && set.reps ? `${set.weight}kg x ${set.reps}` : '--'}
                                                                    {set && set.done && <span className="ml-1">‚úì</span>}
                                                                </div>
                                                            ))}
                                                        </div>
                                                    </div>
                                                ))}
                                            </div>
                                        </div>
                                    ))}
                                </div>
                            )}
                        </div>
                    )}
                    {/* Settings Tab */}
                    {activeTab === 'settings' && (
                        <div className="space-y-6">
                            <div className="glass-effect rounded-2xl p-4 md:p-6 card-hover">
                                <h2 className="text-lg font-semibold mb-6 text-white flex items-center">
                                    <span className="mr-2">üéØ</span>
                                    One Rep Max Settings
                                </h2>
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                    {['bench', 'deadlift', 'squat'].map((lift) => (
                                        <div key={lift} className="space-y-2">
                                            <label className="block text-sm font-medium text-gray-300 capitalize flex items-center">
                                                <span className="mr-2">
                                                    {lift === 'bench' ? 'üèãÔ∏è' : lift === 'deadlift' ? '‚ö°' : 'ü¶µ'}
                                                </span>
                                                {lift} 1RM (kg)
                                            </label>
                                            <input
                                                type="number"
                                                step="0.25"
                                                value={oneRepMaxes[lift]}
                                                onChange={(e) => setOneRepMaxes(prev => ({
                                                    ...prev,
                                                    [lift]: parseFloat(e.target.value) || 0
                                                }))}
                                                className="w-full px-4 py-3 border border-gray-600 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 bg-gray-800 text-white text-lg font-semibold"
                                            />
                                        </div>
                                    ))}
                                </div>
                                <div className="mt-8 p-6 bg-gray-900/70 rounded-xl border border-red-600/20">
                                    <h3 className="font-medium mb-4 text-white flex items-center">
                                        <span className="mr-2">üßÆ</span>
                                        Calculated Working Weights
                                    </h3>
                                    <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                                        {['bench', 'deadlift', 'squat'].map((lift) => (
                                            <div key={lift} className="space-y-2">
                                                <div className="font-medium capitalize text-red-400 flex items-center">
                                                    <span className="mr-2">
                                                        {lift === 'bench' ? 'üèãÔ∏è' : lift === 'deadlift' ? '‚ö°' : 'ü¶µ'}
                                                    </span>
                                                    {lift}
                                                </div>
                                                <div className="space-y-1 text-sm">
                                                    <div className="flex justify-between text-gray-300">
                                                        <span>65%:</span>
                                                        <span className="font-mono font-semibold">{calculateWeight(lift, 65)}kg</span>
                                                    </div>
                                                    <div className="flex justify-between text-gray-300">
                                                        <span>75%:</span>
                                                        <span className="font-mono font-semibold">{calculateWeight(lift, 75)}kg</span>
                                                    </div>
                                                    <div className="flex justify-between text-gray-300">
                                                        <span>85%:</span>
                                                        <span className="font-mono font-semibold">{calculateWeight(lift, 85)}kg</span>
                                                    </div>
                                                    <div className="flex justify-between text-gray-300">
                                                        <span>90%:</span>
                                                        <span className="font-mono font-semibold">{calculateWeight(lift, 90)}kg</span>
                                                    </div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                </div>
                                <div className="mt-8">
                                    <label className="flex items-center space-x-2">
                                        <input
                                            type="checkbox"
                                            checked={lightMode}
                                            onChange={e => setLightMode(e.target.checked)}
                                            className="w-5 h-5 rounded border-gray-600 text-red-600 focus:ring-red-500 bg-gray-800"
                                        />
                                        <span className="text-sm font-medium text-white">Enable Light Mode</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            </div>
        );
    }

    function AddCustomExerciseForm({ onAdd }) {
        const [day, setDay] = React.useState('monday');
        const [name, setName] = React.useState('');
        const [sets, setSets] = React.useState('');
        const [lift, setLift] = React.useState('');
        return (
            <form
                className="flex flex-col sm:flex-row items-center gap-2"
                onSubmit={e => {
                    e.preventDefault();
                    if (!name.trim() || !sets.trim()) return;
                    onAdd(day, name.trim(), sets.trim(), lift.trim() || undefined);
                    setName('');
                    setSets('');
                    setLift('');
                }}
            >
                <select value={day} onChange={e => setDay(e.target.value)}
                    className="border border-gray-600 rounded-xl px-3 py-2 text-sm bg-gray-800 text-white focus:ring-2 focus:ring-red-500">
                    {['monday','tuesday','wednesday','friday','saturday'].map(d => (
                        <option value={d} key={d}>{d.charAt(0).toUpperCase() + d.slice(1)}</option>
                    ))}
                </select>
                <input type="text" value={name} onChange={e => setName(e.target.value)}
                    placeholder="Exercise Name"
                    className="px-3 py-2 border border-gray-600 rounded-lg text-sm bg-gray-900 text-white placeholder-gray-500"
                    maxLength={32}
                />
                <input type="text" value={sets} onChange={e => setSets(e.target.value)}
                    placeholder="Sets e.g. 3x8"
                    className="px-3 py-2 border border-gray-600 rounded-lg text-sm bg-gray-900 text-white placeholder-gray-500"
                    maxLength={24}
                />
                <select value={lift} onChange={e => setLift(e.target.value)}
                    className="border border-gray-600 rounded-xl px-3 py-2 text-sm bg-gray-800 text-white focus:ring-2 focus:ring-red-500"
                >
                    <option value="">No 1RM</option>
                    <option value="bench">Bench</option>
                    <option value="deadlift">Deadlift</option>
                    <option value="squat">Squat</option>
                </select>
                <button type="submit"
                    className="gradient-bg px-4 py-2 rounded-lg text-white text-sm font-semibold hover:scale-105 transition-all"
                >Add</button>
            </form>
        );
    }

    ReactDOM.render(<WorkoutTracker />, document.getElementById('root'));
    </script>
</body>
</html>
